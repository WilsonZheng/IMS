@using IMS.Common
@model IMS.ViewModels.RecruitIndexViewModel
@{
    ViewBag.Title = "Index";
}
<div class="search-panel">
    <form id="searchCondition" class="text-left">Progress Stage : 
        <div class="btn-group" data-toggle="buttons">
            @foreach (var item in Model.RecruitStatusOptions)
            {
                <label class="@(Convert.ToInt32(item.Value)<=(int)RecruitStatusCode.InvitationSent ?"ims-email":"") btn btn-default @(item.Selected?"active":"")  @(Convert.ToInt32(item.Value)==(int)RecruitStatusCode.InvitationCreated?"ims-del":"")">
                    <input type="radio" name="RecruitStatusTypeIds" autocomplete="off"  value="@item.Value"> @item.Text
                </label>
            }
        </div>
    </form>
</div>
<table id="applicant-list" class="display table-bordered table-condensed" cellspacing="0" width="100%">
    <thead>
        <tr>
            <th>Id</th>
            <th>Email</th>
            <th></th>
        </tr>
    </thead>
</table>


@section Scripts{
    <script>
        $(function () {
            //Initialize task button based on selected RecruitStatus.
            var selectedStatus = $("#searchCondition label.active");
            if (selectedStatus.hasClass('ims-email')) {
                $("#applicant-list").addClass("ims-email");
            }
            if (selectedStatus.hasClass('ims-del')) {
                $("#applicant-list").addClass("ims-del");
            }


            var dt = $('#applicant-list').DataTable({
                "deferLoading":57,
                "ajax": { url: "/Recruit/List?RecruitStatusTypeIds=" + $("#searchCondition label.active input[type='radio']").val(), dataSrc: "" },
                "columns": [
                    { "data": "Id" },
                    { "data": "Email" }
                ],
                "columnDefs": [
                    {
                        "render": function (data, type, row) {
                            var temp = "<div class='text-center'>";
                            temp += "<span data-id=" + row['Id'] + " class='cm-resend-invitation glyphicon glyphicon-envelope clickable' data-toggle='tooltip' data-placement='top' title='Resend Invitation'></span>";
                            temp += "<span data-id=" + row['Id'] + " class='cm-delete-applicant glyphicon glyphicon-trash clickable' data-toggle='tooltip' data-placement='top' title='Delete'></span>";
                            temp += "</div>";
                            return temp;
                        },
                        "targets": 2
                    },
                    {
                        "render": function (data, type, row) {
                            return "<div class='text-center'>"+data+"</div>";
                        },
                        "targets": 0
                    }
                ]
            });
            

            $("#searchCondition input[type='radio']").on('change', function () {
                dt.ajax.url("/Recruit/List?RecruitStatusTypeIds=" + $(this).val()).load();
            });

           

            $("#applicant-list").on('click', '.cm-resend-invitation', function () {
                var id = $(this).attr('data-id');
                Ims.confirm("Do you want to resend invitation?");
                Ims.waitObj.then(function () {
                    $.post("/Recruit/SendInvitation", { id:id}).then(function (response) {
                        if (response.Error) {
                            Ims.alert(response.Error);
                        } else {
                            Ims.inform('Completed');
                            if (response.RecruitStatusTypeCode != $("#searchCondition .active input").val()) {
                                dt.row('.selected').remove().draw(false);
                            }
                        }
                    });
                });
            });

            


            $("#applicant-list").on('click', '.cm-delete-applicant', function () {
                var id = $(this).attr('data-id');
                Ims.confirm("Do you want to delete this record?");
                Ims.waitObj.then(function () {
                    $.post("/Recruit/Delete", { id: id }).then(function (response) {
                        if (response.Error) {
                            Ims.alert(response.Error);
                        } else {
                            Ims.inform('Completed');
                            dt.row('.selected').remove().draw(false);
                        }
                    });
                });
            });
            
            $('#applicant-list tbody').on('click', 'tr', function () {
                if (!$(this).hasClass('selected')) {
                    dt.$('tr.selected').removeClass('selected');
                    $(this).addClass('selected');
                }
            });

            var $applicantList = $('#applicant-list');

            $("#searchCondition label").on('click', function () {
                if ($(this).hasClass("ims-email")) {
                    $applicantList.addClass("ims-email");
                } else {
                    $applicantList.removeClass("ims-email");
                }

                if ($(this).hasClass("ims-del")) {
                    $applicantList.addClass("ims-del");
                } else {
                    $applicantList.removeClass("ims-del");
                }
             
            });
        });
    </script>
  
}